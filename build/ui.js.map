{"version":3,"sources":["ui.ts"],"names":["Ui","Ui.constructor","Ui.render","Ui.renderNodes","Ui.redrawNodes"],"mappings":"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","file":"ui.js","sourcesContent":["import * as d3 from 'd3'\nimport * as cola from 'webcola'\nimport * as am from 'asyncmachine'\nimport Graph from 'graphs'\nimport {\n\tID3NetworkJson\n} from './d3network'\n\n// TODO this is so bad\nwindow.d3 = d3\n\n/**\n * TODO consume a stream of events\n * TODO support an initialization without a reference to other instances\n */\nexport default class Ui {\n\n\tmachine_color: D3.Scale.OrdinalScale;\n\tstate_color: D3.Scale.OrdinalScale;\n\tlayout: cola.LayoutAdaptor;\n\tcontainer: D3.Selection;\n\n\tlink: D3.Selection;\n\tnode: D3.Selection;\n\tgroup: D3.Selection;\n\tlabel: D3.Selection;\n\n\tpad = 3;\n\twidth = 800;\n\theight = 600;\n\n\tconstructor(\n\t\t\tpublic data: ID3NetworkJson) {\n\n\t\tthis.machine_color = d3.scale.category10()\n\t\tthis.state_color = d3.scale.category20c()\n\n\t\tfor (let node of this.data.nodes) {\n\t\t\tnode.width = node.name.length * 20\n\t\t\tnode.height = 25\n\t\t}\n\n\t\tthis.layout = cola.d3adaptor()\n\t\t\t.linkDistance(100)\n\t\t\t.avoidOverlaps(true)\n\t\t\t.handleDisconnected(false)\n\t\t\t.nodes(this.data.nodes)\n\t\t\t.links(this.data.links)\n\t\t\t.groups(this.data.groups)\n\t\t\t.size([this.width, this.height])\n\t}\n\n\trender() {\n\t\t// TODO customizable container\n\t\tthis.container = d3.select(\"body\").append(\"svg\")\n\t\t\t.attr(\"width\", this.width)\n\t\t\t.attr(\"height\", this.height)\n\n\t\tthis.layout.start()\n\t\tthis.renderNodes()\n\t}\n\n\trenderNodes() {\n\t\tthis.group = this.container.selectAll(\".group\")\n\t\t\t.data(this.data.groups)\n\t\t\t.enter().append(\"rect\")\n\t\t\t\t.attr(\"rx\", 8).attr(\"ry\", 8)\n\t\t\t\t.attr(\"class\", \"group\")\n\t\t\t\t.style(\"fill\", (d) => this.machine_color(d.id) )\n\t\t\t\t.call(this.layout.drag);\n\n\t\tthis.link = this.container.selectAll(\".link\")\n\t\t\t.data(this.data.links)\n\t\t\t.enter().append(\"line\")\n\t\t\t\t.attr(\"class\", \"link\");\n\n\t\tthis.node = this.container.selectAll(\".node\")\n\t\t\t.data(this.data.nodes)\n\t\t\t.enter().append(\"rect\")\n\t\t\t\t.attr(\"class\", \"node\")\n\t\t\t\t.attr(\"width\", d => d.width - 2 * this.pad )\n\t\t\t\t.attr(\"height\", d =>  d.height - 2 * this.pad )\n\t\t\t\t.attr(\"rx\", 5).attr(\"ry\", 5)\n\t\t\t\t.style(\"fill\", d => this.state_color(d.name) )\n\t\t\t\t.call(this.layout.drag);\n\n\t\tthis.label = this.container.selectAll(\".label\")\n\t\t\t.data(this.data.nodes)\n\t\t\t.enter().append(\"text\")\n\t\t\t\t.attr(\"class\", \"label\")\n\t\t\t\t.text(d => d.name )\n\t\t\t\t.call(this.layout.drag);\n\n\t\tthis.node.append(\"title\")\n\t\t\t.text(d => d.name )\n\n\t\tthis.layout.on(\"tick\", this.redrawNodes.bind(this));\n\t}\n\n\tredrawNodes() {\n\t\tthis.link.attr(\"x1\", d => d.source.x )\n\t\t\t.attr(\"y1\", d => d.source.y )\n\t\t\t.attr(\"x2\", d => d.target.x )\n\t\t\t.attr(\"y2\", d => d.target.y );\n\n\t\tthis.node.attr(\"x\", d => d.x - d.width / 2 + this.pad )\n\t\t\t.attr(\"y\", d => d.y - d.height / 2 + this.pad );\n\n\t\tthis.group.attr(\"x\", d => d.bounds.x )\n\t\t\t.attr(\"y\", d => d.bounds.y )\n\t\t\t.attr(\"width\", d => d.bounds.width() )\n\t\t\t.attr(\"height\", d => d.bounds.height() );\n\n\t\tthis.label.attr(\"x\", d => d.x )\n\t\t\t.attr(\"y\", function(d) {\n\t\t\t\tvar h = this.getBBox().height;\n\t\t\t\treturn d.y + h/4;\n\t\t\t});\n\t}\n}\n"],"sourceRoot":"/source/"}