{"version":3,"sources":["src/ui.ts","src/ui.js"],"names":["Ui","Ui.constructor","Ui.render","Ui.renderNodes","Ui.redrawNodes"],"mappings":"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","file":"src/ui.js","sourcesContent":["import * as d3 from 'd3'\nimport * as cola from 'webcola'\nimport * as am from 'asyncmachine'\nimport Graph from 'graphs'\nimport {\n\tID3NetworkJson\n} from './d3network'\n\n// TODO this is so bad\nwindow.d3 = d3\n\n/**\n * TODO consume a stream of events\n * TODO support an initialization without a reference to other instances\n */\nexport default class Ui {\n\n\tmachine_color: D3.Scale.OrdinalScale;\n\tstate_color: D3.Scale.OrdinalScale;\n\tlayout: cola.LayoutAdaptor;\n\tcontainer: D3.Selection;\n\n\tlink: D3.Selection;\n\tnode: D3.Selection;\n\tgroup: D3.Selection;\n\tlabel: D3.Selection;\n\n\tpad = 3;\n\twidth = 800;\n\theight = 600;\n\n\tconstructor(\n\t\t\tpublic data: ID3NetworkJson) {\n\n\t\tthis.machine_color = d3.scale.category10()\n\t\tthis.state_color = d3.scale.category20c()\n\n\t\tfor (let node of this.data.nodes) {\n\t\t\tnode.width = node.name.length * 20\n\t\t\tnode.height = 25\n\t\t}\n\n\t\tthis.layout = cola.d3adaptor()\n\t\t\t.linkDistance(100)\n\t\t\t.avoidOverlaps(true)\n\t\t\t.handleDisconnected(false)\n\t\t\t.nodes(this.data.nodes)\n\t\t\t.links(this.data.links)\n\t\t\t.groups(this.data.groups)\n\t\t\t.size([this.width, this.height])\n\t}\n\n\trender() {\n\t\t// TODO customizable container\n\t\tthis.container = d3.select(\"body\").append(\"svg\")\n\t\t\t.attr(\"width\", this.width)\n\t\t\t.attr(\"height\", this.height)\n\n\t\tthis.layout.start()\n\t\tthis.renderNodes()\n\t}\n\n\trenderNodes() {\n\t\tthis.group = this.container.selectAll(\".group\")\n\t\t\t.data(this.data.groups)\n\t\t\t.enter().append(\"rect\")\n\t\t\t\t.attr(\"rx\", 8).attr(\"ry\", 8)\n\t\t\t\t.attr(\"class\", \"group\")\n\t\t\t\t.style(\"fill\", (d) => this.machine_color(d.id) )\n\t\t\t\t.call(this.layout.drag);\n\n\t\tthis.link = this.container.selectAll(\".link\")\n\t\t\t.data(this.data.links)\n\t\t\t.enter().append(\"line\")\n\t\t\t\t.attr(\"class\", \"link\");\n\n\t\tthis.node = this.container.selectAll(\".node\")\n\t\t\t.data(this.data.nodes)\n\t\t\t.enter().append(\"rect\")\n\t\t\t\t.attr(\"class\", \"node\")\n\t\t\t\t.attr(\"width\", d => d.width - 2 * this.pad )\n\t\t\t\t.attr(\"height\", d =>  d.height - 2 * this.pad )\n\t\t\t\t.attr(\"rx\", 5).attr(\"ry\", 5)\n\t\t\t\t.style(\"fill\", d => this.state_color(d.name) )\n\t\t\t\t.call(this.layout.drag);\n\n\t\tthis.label = this.container.selectAll(\".label\")\n\t\t\t.data(this.data.nodes)\n\t\t\t.enter().append(\"text\")\n\t\t\t\t.attr(\"class\", \"label\")\n\t\t\t\t.text(d => d.name )\n\t\t\t\t.call(this.layout.drag);\n\n\t\tthis.node.append(\"title\")\n\t\t\t.text(d => d.name )\n\n\t\tthis.layout.on(\"tick\", this.redrawNodes.bind(this));\n\t}\n\n\tredrawNodes() {\n\t\tthis.link.attr(\"x1\", d => d.source.x )\n\t\t\t.attr(\"y1\", d => d.source.y )\n\t\t\t.attr(\"x2\", d => d.target.x )\n\t\t\t.attr(\"y2\", d => d.target.y );\n\n\t\tthis.node.attr(\"x\", d => d.x - d.width / 2 + this.pad )\n\t\t\t.attr(\"y\", d => d.y - d.height / 2 + this.pad );\n\n\t\tthis.group.attr(\"x\", d => d.bounds.x )\n\t\t\t.attr(\"y\", d => d.bounds.y )\n\t\t\t.attr(\"width\", d => d.bounds.width() )\n\t\t\t.attr(\"height\", d => d.bounds.height() );\n\n\t\tthis.label.attr(\"x\", d => d.x )\n\t\t\t.attr(\"y\", function(d) {\n\t\t\t\tvar h = this.getBBox().height;\n\t\t\t\treturn d.y + h/4;\n\t\t\t});\n\t}\n}\n","var d3 = require('d3');\nvar cola = require('webcola');\n// TODO this is so bad\nwindow.d3 = d3;\n/**\n * TODO consume a stream of events\n * TODO support an initialization without a reference to other instances\n */\nvar Ui = (function () {\n    function Ui(data) {\n        this.data = data;\n        this.pad = 3;\n        this.width = 800;\n        this.height = 600;\n        this.machine_color = d3.scale.category10();\n        this.state_color = d3.scale.category20c();\n        for (var _i = 0, _a = this.data.nodes; _i < _a.length; _i++) {\n            var node = _a[_i];\n            node.width = node.name.length * 20;\n            node.height = 25;\n        }\n        this.layout = cola.d3adaptor()\n            .linkDistance(100)\n            .avoidOverlaps(true)\n            .handleDisconnected(false)\n            .nodes(this.data.nodes)\n            .links(this.data.links)\n            .groups(this.data.groups)\n            .size([this.width, this.height]);\n    }\n    Ui.prototype.render = function () {\n        // TODO customizable container\n        this.container = d3.select(\"body\").append(\"svg\")\n            .attr(\"width\", this.width)\n            .attr(\"height\", this.height);\n        this.layout.start();\n        this.renderNodes();\n    };\n    Ui.prototype.renderNodes = function () {\n        var _this = this;\n        this.group = this.container.selectAll(\".group\")\n            .data(this.data.groups)\n            .enter().append(\"rect\")\n            .attr(\"rx\", 8).attr(\"ry\", 8)\n            .attr(\"class\", \"group\")\n            .style(\"fill\", function (d) { return _this.machine_color(d.id); })\n            .call(this.layout.drag);\n        this.link = this.container.selectAll(\".link\")\n            .data(this.data.links)\n            .enter().append(\"line\")\n            .attr(\"class\", \"link\");\n        this.node = this.container.selectAll(\".node\")\n            .data(this.data.nodes)\n            .enter().append(\"rect\")\n            .attr(\"class\", \"node\")\n            .attr(\"width\", function (d) { return d.width - 2 * _this.pad; })\n            .attr(\"height\", function (d) { return d.height - 2 * _this.pad; })\n            .attr(\"rx\", 5).attr(\"ry\", 5)\n            .style(\"fill\", function (d) { return _this.state_color(d.name); })\n            .call(this.layout.drag);\n        this.label = this.container.selectAll(\".label\")\n            .data(this.data.nodes)\n            .enter().append(\"text\")\n            .attr(\"class\", \"label\")\n            .text(function (d) { return d.name; })\n            .call(this.layout.drag);\n        this.node.append(\"title\")\n            .text(function (d) { return d.name; });\n        this.layout.on(\"tick\", this.redrawNodes.bind(this));\n    };\n    Ui.prototype.redrawNodes = function () {\n        var _this = this;\n        this.link.attr(\"x1\", function (d) { return d.source.x; })\n            .attr(\"y1\", function (d) { return d.source.y; })\n            .attr(\"x2\", function (d) { return d.target.x; })\n            .attr(\"y2\", function (d) { return d.target.y; });\n        this.node.attr(\"x\", function (d) { return d.x - d.width / 2 + _this.pad; })\n            .attr(\"y\", function (d) { return d.y - d.height / 2 + _this.pad; });\n        this.group.attr(\"x\", function (d) { return d.bounds.x; })\n            .attr(\"y\", function (d) { return d.bounds.y; })\n            .attr(\"width\", function (d) { return d.bounds.width(); })\n            .attr(\"height\", function (d) { return d.bounds.height(); });\n        this.label.attr(\"x\", function (d) { return d.x; })\n            .attr(\"y\", function (d) {\n            var h = this.getBBox().height;\n            return d.y + h / 4;\n        });\n    };\n    return Ui;\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = Ui;"],"sourceRoot":"/source/"}